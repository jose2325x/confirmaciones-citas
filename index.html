<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Confirmaci√≥n de Cita</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 100px;
        }
        h2.confirmado {
            color: green;
        }
        h2.cancelado {
            color: red;
        }
        h2.reprogramado {
            color: orange;
        }
        p {
            font-size: 1.1em;
        }
    </style>
</head>
<body>

    <!-- Mensaje din√°mico -->
    <h2 id="mensaje-titulo">Cargando...</h2>
    <p id="mensaje-detalle"></p>

    <!-- Imagen invisible que dispara el webhook -->
    <img id="webhook-trigger" src="" style="display:none;" />

    <script>
        // Funci√≥n para obtener par√°metros de la URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Obtener par√°metros y convertir "accion" a may√∫sculas
        var cita_id = getUrlParameter('cita_id');
        var accion = getUrlParameter('accion').toUpperCase();  

        // Elementos del DOM
        var titulo = document.getElementById("mensaje-titulo");
        var detalle = document.getElementById("mensaje-detalle");

        // Validar y mostrar mensaje seg√∫n la acci√≥n (ya en may√∫sculas)
        if (accion === 'CONFIRMAR') {
            titulo.textContent = "‚úÖ Gracias por confirmar";
            titulo.className = "confirmado";
            detalle.textContent = "Tu cita ha sido confirmada exitosamente.";
        } else if (accion === 'CANCELAR') {
            titulo.textContent = "‚ùå Cita Cancelada";
            titulo.className = "cancelado";
            detalle.textContent = "Tu cita ha sido cancelada.";
        } else if (accion === 'REPROGRAMAR') {
            titulo.textContent = "üîÑ Solicitud de Reprogramaci√≥n";
            titulo.className = "reprogramado";
            detalle.textContent = "Hemos recibido tu solicitud de reprogramaci√≥n.";
        } else {
            titulo.textContent = "‚ö†Ô∏è Acci√≥n no reconocida";
            titulo.className = "";
            detalle.textContent = "No se pudo identificar la acci√≥n realizada.";
        }

        // Disparar webhook solo si hay cita_id y accion v√°lida
        if (cita_id && ['CONFIRMAR', 'CANCELAR', 'REPROGRAMAR'].includes(accion)) {
            var webhookUrl = 'https://prod-54.westus.logic.azure.com/workflows/e6ca8021d694492998bd18f5e45dbbb5/triggers/manual/paths/invoke/confirmacioncita?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=A8h4p5aTqsH7Irxmm0vGk8gSTmgqp5FbcCv-H5wy3tE&cita_id=' + encodeURIComponent(cita_id) + '&accion=' + encodeURIComponent(accion);

            document.getElementById('webhook-trigger').src = webhookUrl;
        }
    </script>
</body>
</html>